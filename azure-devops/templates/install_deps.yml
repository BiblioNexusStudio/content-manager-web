parameters:
    - name: WorkingDirectory
      type: string
      default: '.'

steps:
    - template: templates/setup_node.yml@devops

    - script: cat patches/*.patch | md5sum > patches/lock
      workingDirectory: ${{ parameters.WorkingDirectory }}
      displayName: Generate patch lock file

    - task: Cache@2
      inputs:
          key: 'v1 | yarn | "$(Agent.OS)" | ${{ parameters.WorkingDirectory }}/yarn.lock | ${{ parameters.WorkingDirectory }}/patches/lock'
          path: ${{ parameters.WorkingDirectory }}/node_modules
      displayName: Cache yarn dependencies

    - script: yarn install --frozen-lockfile
      workingDirectory: ${{ parameters.WorkingDirectory }}
      displayName: Install dependencies
